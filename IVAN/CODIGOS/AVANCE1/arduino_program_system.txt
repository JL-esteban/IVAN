// Motor A (Izquierdo)
const int AIN1 = 25;
const int AIN2 = 26;
const int PWMA = 27;

// Motor B (Derecho)
const int BIN1 = 32;
const int BIN2 = 33;
const int PWMB = 14;

// Standby (debe estar en HIGH para funcionar)
const int STBY = 12;

const int velocidad = 255; // 0-255

String comando = "";

void setup() {
  Serial.begin(115200); // ESP32 usa 115200 normalmente
  
  // Configurar pines como salida
  pinMode(AIN1, OUTPUT);
  pinMode(AIN2, OUTPUT);
  pinMode(PWMA, OUTPUT);
  pinMode(BIN1, OUTPUT);
  pinMode(BIN2, OUTPUT);
  pinMode(PWMB, OUTPUT);
  pinMode(STBY, OUTPUT);
  
  // Activar TB6612FNG
  digitalWrite(STBY, HIGH);
  
  // Detener motores al inicio
  detener();
  
  Serial.println("=== Barco RC WiFi ===");
  Serial.println("Comandos:");
  Serial.println("F - Adelante");
  Serial.println("B - Atrás");
  Serial.println("L - Izquierda");
  Serial.println("R - Derecha");
  Serial.println("S - Stop");

}

void loop() {
  if (Serial.available() > 0) {
    comando = Serial.readStringUntil('\n');
    comando.trim();
    comando.toUpperCase();
    
    ejecutarMovimiento(comando);
  }
}


void ejecutarMovimiento(String cmd) {
  if (cmd == "F") {
    adelante();
  }
  else if (cmd == "B") {
    atras();
  }
  else if (cmd == "L") {
    izquierda();
  }
  else if (cmd == "R") {
    derecha();
  }
  else if (cmd == "S") {
    detener();
  }
}



void adelante() {
  Serial.println("-> Adelante");
  // Motor A adelante
  digitalWrite(AIN1, HIGH);
  digitalWrite(AIN2, LOW);
  analogWrite(PWMA, velocidad);
  
  // Motor B adelante
  digitalWrite(BIN1, HIGH);
  digitalWrite(BIN2, LOW);
  analogWrite(PWMB, velocidad);
}

void atras() {
  Serial.println("-> Atrás");
  // Motor A atrás
  digitalWrite(AIN1, LOW);
  digitalWrite(AIN2, HIGH);
  analogWrite(PWMA, velocidad);
  
  // Motor B atrás
  digitalWrite(BIN1, LOW);
  digitalWrite(BIN2, HIGH);
  analogWrite(PWMB, velocidad);
}

void izquierda() {
  Serial.println("-> Izquierda");
  // Motor A atrás (o detenido)
  digitalWrite(AIN1, LOW);
  digitalWrite(AIN2, HIGH);
  analogWrite(PWMA, velocidad);
  
  // Motor B adelante
  digitalWrite(BIN1, HIGH);
  digitalWrite(BIN2, LOW);
  analogWrite(PWMB, velocidad);
}

void derecha() {
  Serial.println("-> Derecha");
  // Motor A adelante
  digitalWrite(AIN1, HIGH);
  digitalWrite(AIN2, LOW);
  analogWrite(PWMA, velocidad);
  
  // Motor B atrás (o detenido)
  digitalWrite(BIN1, LOW);
  digitalWrite(BIN2, HIGH);
  analogWrite(PWMB, velocidad);
}

void detener() {
  Serial.println("-> Stop");
  // Detener ambos motores
  digitalWrite(AIN1, LOW);
  digitalWrite(AIN2, LOW);
  analogWrite(PWMA, 0);
  
  digitalWrite(BIN1, LOW);
  digitalWrite(BIN2, LOW);
  analogWrite(PWMB, 0);
}